##### Πληροφορίες
- Υλοποίηση προγράμματος από: Κωνσταντίνο Γεώργιο Βλαζάκη (sdi2300017)
- Λειτουργικό σύστημα όπου εκτελέστηκαν τα προγράμματα: Linux Mint 22.2 Cinnamon
- CPU: AMD Ryzen 5 7600 6-Core Processor
- GCC version: gcc (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0

### Εκτελούμενα προγράμματα
- **main.c**:
	Το πρόγραμμα υλοποιεί μια απλή λειτουργία **παράλληλης αύξησης** (increment) μιας κοινόχρηστης μεταβλητής **χωρίς συγχρονισμό**. Η τελική τιμή της κοινόχρηστης μεταβλητής είναι **μη ντετερμινιστική**.
	
	* Global αρχικοποιήσεις:
		- Ο ακέραιος **"thread_count"**: Ο συνολικός αριθμός νημάτων που θα δημιουργηθούν, λαμβάνεται από τα ορίσματα της γραμμής εντολών.
		- Ο ακέραιος **"increment_count"**: Ο αριθμός των επαναλήψεων (αυξήσεων) που θα εκτελέσει κάθε νήμα μεμονωμένα, λαμβάνεται από τα ορίσματα της γραμμής εντολών.
	
	* Συνάρτηση νήματος **"increment"**:
		- Λειτουργία:
			- Η συνάρτηση λαμβάνει ως όρισμα έναν δείκτη προς την κοινόχρηστη μεταβλητή shared (η οποία ονομάζεται **val** τοπικά μέσα στη συνάρτηση).
			- **CRITICAL SECTION**: Εκτελεί έναν βρόχο **for** από το 0 έως το **increment_count**. Σε κάθε επανάληψη, αυξάνει την τιμή της κοινόχρηστης μεταβλητής **(\*val += 1)**.
			- Αυτή η λειτουργία αποτελεί το **Critical Section** του προγράμματος, καθώς τα νήματα προσπαθούν ταυτόχρονα να τροποποιήσουν την ίδια μεταβλητή, οδηγώντας σε **απώλεια αυξήσεων**.
			- Η συνάρτηση επιστρέφει **NULL**.
	
	* Κύριο νήμα **"main"**:
		- Αρχικοποιήσεις:
			- Δύο στιγμιότυπα της δομής **"timespec"** (**execution_start**, **execution_finish**) για τη μέτρηση του συνολικού χρόνου εκτέλεσης.
			- Άνοιγμα του αρχείου **"results.txt"** σε **append mode (a)** για την αποθήκευση του χρόνου εκτέλεσης.
			- Λήψη των ορισμάτων **"thread_count"** και **"increment_count"** από τη γραμμή εντολών.
			- Δήλωση και αρχικοποίηση της κοινόχρηστης μεταβλητής **"shared"** με τιμή 0.
			- Δέσμευση μνήμης για τη λίστα νημάτων **"pthread\_t"** (**thread\_handle**) μεγέθους **thread_count**.
			- Καταγραφή του χρόνου έναρξης εκτέλεσης μέσω της **"timespec_get"** (**execution_start**).
		- Βρόχος **for**:
			- Τρέχει από το 0 έως το **"thread\_count"**.
			- Σε κάθε επανάληψη, καλείται η συνάρτηση **"pthread\_create"** για τη δημιουργία ενός νήματος.
			- Ως συνάρτηση νήματος δίνεται η **"increment"**.
			- Ως όρισμα της συνάρτησης νήματος δίνεται ο δείκτης προς την κοινόχρηστη μεταβλητή **"shared"**.
		- Βρόχος τερματισμού νημάτων **for**:
			- Τρέχει από το 0 έως το **"thread\_count"**.
			- Καλείται η συνάρτηση **"pthread\_join"** για να τερματιστούν όλα τα νήματα.
		- **Μέτρηση χρόνου:**
			- Καταγραφή του χρόνου ολοκλήρωσης εκτέλεσης (**execution_finish**).
			- Υπολογισμός του συνολικού χρόνου εκτέλεσης με τη χρήση της βοηθητικής συνάρτησης **"time\_elapsed"**.
		- **Τελικές ενέργειες:**
			- Εγγραφή του χρόνου εκτέλεσης στο αρχείο **"results.txt"**.
			- Αποδεσμεύονται όσοι δείκτες έχουν χρησιμοποιηθεί.
			- Εκτύπωση της τελικής τιμής της **"shared"** και του χρόνου εκτέλεσης.
	
	* Βοηθητικές συναρτήσεις
		- **time\_elapsed**:
			- Ορίσματα:
				- Ένα στιγμιότυπο της δομής **"timespec"** το οποίο δηλώνει την αρχή του χρονικού διαστήματος.
				- Ένα στιγμιότυπο της δομής **"timespec"** το οποίο δηλώνει το τέλος του χρονικού διαστήματος.
			- Λειτουργία:
				- Επιστρέφει τον συνολικό χρόνο που έχει περάσει ανάμεσα στα δύο χρονικά διαστήματα, σε δεκαδική (**double**) μορφή **"sec.nsec"**.
	
- **mutex.c**: Η γενικότερη υλοποίηση του προγράμματος παραμένει ίδια με την **"main.c"**, με μοναδική διαφορά τη χρήση **κλειδώματος αμοιβαίου αποκλεισμού** στη συνάρτηση νήματος **"increment"**.
	- Global αρχικοποιήσεις:
		- Μία επιπλέον δομή **"pthread\_mutex\_t"** με το όνομα **"mutex"** που χρησιμοποιείται για κλείδωμα αμοιβαίου αποκλεισμού.
	- Κύριο νήμα (**main**):
		- Αρχικοποίηση του lock **"mutex"** με την **pthread\_mutex\_init**. Καταστροφή του με την **pthread\_mutex\_destroy**.
	- Συνάρτηση νήματος **"increment"**:
		- Ενθυλακώνουμε τον βρόχο **for** ανάμεσα σε ένα κλείδωμα πάνω στο lock **"mutex"** και στο αντίστοιχο ξεκλείδωμα.

- **rw.c**: Η γενικότερη υλοποίηση του προγράμματος παραμένει ίδια με την **"main.c"**, με μοναδική διαφορά τη χρήση **κλειδώματος ανάγνωσης-εγγραφής** στη συνάρτηση νήματος **"increment"**. Στο πρόγραμμα χρησιμοποιείται μονάχα κλείδωμα εγγραφής, εφόσον δεν υπάρχει κάποια λειτουργία ανάγνωσης στην περιγραφή του προβλήματος.
	- Global αρχικοποιήσεις:
		- Μία επιπλέον δομή **"pthread\_rwlock\_t"** με το όνομα **"rwlock"** που χρησιμοποιείται για κλείδωμα ανάγνωσης-εγγραφής.
	- Κύριο νήμα (**main**):
		- Αρχικοποίηση του lock **"rwlock"** με την **pthread\_rwlock\_init**. Καταστροφή του με την **pthread\_rwlock\_destroy**.
	- Συνάρτηση νήματος **"increment"**:
		- Ενθυλακώνουμε τον βρόχο **for** ανάμεσα σε ένα κλείδωμα πάνω στο lock **"rwlock"** και στο αντίστοιχο ξεκλείδωμα. Θα χρησιμοποιηθεί **κλείδωμα εγγραφής (\`pthread\_rwlock\_wrlock\`)**, εφόσον η συνάρτηση κάνει αλλαγές στην κοινόχρηστη μεταβλητή.

- **atomic.c**: Η γενικότερη υλοποίηση του προγράμματος παραμένει ίδια με την **"main.c"**, με μοναδική διαφορά τη μετατροπή της κοινόχρηστης μεταβλητής σε **"Atomic long"** στην συνάρτηση νήματος **"increment"**.
	- Κύριο νήμα (**main**):
		- Δημιουργία της κοινόχρηστης μεταβλητής **"shared"** ως **"Atomic long"**.
	- Συνάρτηση νήματος **"increment"**:
		- Μετατρέπουμε την τοπική μεταβλητή **"val"**, της οποίας η τιμή αντιστοιχεί στην τιμή της κοινόχρηστης μεταβλητής **"shared"**, σε **"Atomic long"**.

---

### Test script
- Το bash script με όνομα **"compare\_script.sh"** χρησιμοποιείται για την εξέταση της λειτουργικότητας των παραπάνω προγραμμάτων.

##### Υλοποίηση του test script
- Το **compare\_script** λαμβάνει τα ακόλουθα ορίσματα:
	- Τον αριθμό των **δειγματικών εκτελέσεων** του κάθε προγράμματος (**S**).
	- Τον αριθμό των **νημάτων** που θα χρησιμοποιηθούν στην εκτέλεση του κάθε προγράμματος (**T**).
	- Τον αριθμό των **επαναλήψεων** που θα εκτελέσει ο βρόχος **for** στη **thread function** του κάθε προγράμματος (**R**).
- Ξεκινάει αρχικοποιώντας τα ακόλουθα κενά αρχεία:
	- **results.txt**: το οποίο θα περιέχει τον χρόνο κάθε εκτέλεσης προγράμματος που πραγματοποιεί το script.
	- **main.out**: Το οποίο θα περιέχει την ολοκληρωτική έξοδο του προγράμματος **main**.
	- **mutex.out**: Το οποίο θα περιέχει την ολοκληρωτική έξοδο του προγράμματος **mutex**.
	- **atomic.out**: Το οποίο θα περιέχει την ολοκληρωτική έξοδο του προγράμματος **atomic**.
	- **rw.out**: Το οποίο θα περιέχει την ολοκληρωτική έξοδο του προγράμματος **rw**.
- Στη συνέχεια, **μεταγλωττίζει** τον πηγαίο κώδικα κάθε προγράμματος και εκτελεί το καθένα όσες φορές έχει επιλέξει ο χρήστης.
- Τέλος, **μεταγλωττίζει** το πρόγραμμα **compare** και το εκτελεί ώστε να συγκριθούν οι μέσοι όροι του χρόνου εκτέλεσης κάθε προγράμματος.

##### Εκτέλεση του script
- Με την εντολή **"make test"**, το script εκτελείται μέσω του **Makefile** με προεπιλεγμένες τιμές για τα πεδία ορισμάτων (**5** δειγματικές εκτελέσεις, **4** νήματα και **1000000** επαναλήψεις στο thread function).
- Με μία εντολή όπως για παράδειγμα **"make test S=6 T=5 R=100"** τρέχουμε το **compare\_script.sh** με 6 δειγματικές εκτελέσεις, 5 νήματα και 100 επαναλήψεις στο thread function.
- Το script μπορεί επίσης να εκτελεστεί ανεξάρτητα από το **Makefile**, με μία εντολή όπως για παράδειγμα **"./compare\_script.sh 6 5 100"**, με 6 δειγματικές εκτελέσεις, 5 νήματα και 100 επαναλήψεις στο thread function.

---

### Συμπεράσματα

- Με σταθερό αριθμό νημάτων **T=4**. Δεν λαμβάνουμε υπόψη τον χρόνο εκτέλεσης της **main.c** υλοποίησης όταν έχουμε **R=100000** και **R=1000000**, εφόσον η τιμή που εκτυπώνει είναι **μη-ντετερμινιστική**.

| Lock type | R=10000 | R=100000 | R=1000000 |
| :--- | :--- | :--- | :--- |
| None (**non-deterministic**) | 0.000080 | - | - |
| Mutex | 0.000085 | 0.000381 | 0.001121 |
| RW | 0.000140 | 0.001345 | 0.016133 |
| Atomic var. | 0.000139 | 0.001121 | 0.010964 |

- Με σταθερό αριθμό επαναλήψεων **R=1000000**. Δεν λαμβάνουμε υπόψη τον χρόνο εκτέλεσης της **main.c** υλοποίησης, εφόσον η τιμή που εκτυπώνει είναι **μη-ντετερμινιστική**.

| Lock type | T=4 | T=8 | T=16 |
| :--- | :--- | :--- | :--- |
| None (**non-deterministic**) | - | - | - |
| Mutex | 0.003591 | 0.014268 | 0.018024 |
| RW | 0.014268 | 0.034335 | 0.088480 |
| Atomic var. | 0.010613 | 0.024128 | 0.069877 |